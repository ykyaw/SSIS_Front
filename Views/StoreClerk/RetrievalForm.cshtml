
@{
    ViewData["Title"] = "Retrieval Form";
    Retrieval retrieval = (Retrieval)ViewData["Retrieval"];
    string disbursedDate = SSIS_FRONT.Utils.TimeUtil.convertTimestampToyyyyMMdd(retrieval.DisbursedDate);
    Dictionary<string, List<RequisitionDetail>> categoryByProduct = (Dictionary<string, List<RequisitionDetail>>)ViewData["categoryByProduct"];
}

<h2 class="titlecenter">@ViewData["Title"]</h2>



<div class="container" style="margin-top: 20px;">
    <table id="form">
        <tr>
            <td>For Date of disbursement: </td>
            <td>&nbsp;&nbsp;&nbsp;</td>
            <td>@disbursedDate</td>
        </tr>
        <tr>
            <td id="retrievalId" value="@retrieval.Id">Retrieval Id: </td>
            <td>&nbsp;&nbsp;&nbsp;</td>
            <td>@retrieval.Id</td>
        </tr>
        <tr>
            <td>Status: </td>
            <td>&nbsp;&nbsp;&nbsp;</td>
            <td id="status">@retrieval.Status</td>
        </tr>
        <tr>
            <td>Date of retrieval: </td>
            <td>&nbsp;&nbsp;&nbsp;</td>
            <td></td>
        </tr>
        <tr>
            <td>Retrieved By: </td>
            <td>&nbsp;&nbsp;&nbsp;</td>
            <td>@retrieval.Clerk.Name</td>
        </tr>
    </table>
</div>



<div class="container" style="margin-top: 20px;">
    @{
        foreach (KeyValuePair<string, List<RequisitionDetail>> kvp in categoryByProduct)
        {
            <table class="table">
                <thead class="thead-dark">
                    <tr>
                        <th colspan="8">
                            @kvp.Value[0].Product.Description
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>Bin</th>
                        <th>Needed</th>
                        <th>Retrieved</th>
                        <th>RequisitionId</th>
                        <th>Department</th>
                        <th>Needed</th>
                        <th>Actual</th>
                        <th>Remarks</th>
                    </tr>
                    @for (int i = 0; i < kvp.Value.Count(); i++)
                    {
                        <tr id="@kvp.Value[i].Id">
                            @if (i == 0)
                            {
                                <td rowspan="@kvp.Value.Count()"> @kvp.Value[i].Product.Category.BinNo</td>
                                <td rowspan="@kvp.Value.Count()">@kvp.Value.Sum(item => item.QtyNeeded)</td>
                                <td rowspan="@kvp.Value.Count()" class="retrieved">@kvp.Value.Sum(item => item.QtyNeeded)</td>
                            }
                            <td> @kvp.Value[i].RequisitionId</td>
                            <td>@kvp.Value[i].Requisition.Department.Name</td>
                            <td>@kvp.Value[i].QtyNeeded</td>
                            <td><input type="number" class="actualNumber" value="@kvp.Value[i].QtyDisbursed" /></td>
                            <td><input type="text" class="remarks" value="@kvp.Value[i].DisburseRemark" /></td>

                        </tr>
                    }
                </tbody>
            </table>
            <br />
        }
    }
</div>
<div class="container">
    <div class="row justify-content-start">
        <div class="col-12">
            <textarea rows="3" id="comments" style="display:none" class="form-control "></textarea>
        </div>
    </div>
</div>
<br />
<div class="container">
    <div class="row justify-content-start">
        <div class="col-3 form-check">
            <label class="form-check-label">Adjustment Voucher needed?</label>
        </div>
        <div class="col-1">
            <input id="needVoucher" type="checkbox" class="form-check-input" />
        </div>
        <div class="col-1">
            <button id="update" class="btn btn-warning">Update</button>
        </div>
        <div class="col-2">
            <button id="finalise" class="btn btn-success">Finalise Retrieval</button>
        </div>
    </div>
</div>



@*<h1>@ViewData["Title"]</h1>
    <span>For Date of disbursement: @disbursedDate</span>

    <h6 id="retrievalId" value="@retrieval.Id">Retrieval Id: @retrieval.Id</h6>
    <h6>Status:@retrieval.Status</h6>
    <h6>Date of retrieval:</h6>
    <h6>Retrieved By: @retrieval.Clerk.Name</h6>
    @{
        foreach (KeyValuePair<string, List<RequisitionDetail>> kvp in categoryByProduct)
        {
            <h5>@kvp.Value[0].Product.Description</h5>
            <table>
                <tr>
                    <th>Bin</th>
                    <th>Needed</th>
                    <th>Retrieved</th>
                    <th>RequisitionId</th>
                    <th>Department</th>
                    <th>Needed</th>
                    <th>Actual</th>
                    <th>Remarks</th>
                </tr>
                @for (int i = 0; i < kvp.Value.Count(); i++)
                {
            <tr id="@kvp.Value[i].Id">
                @if (i == 0)
                {
                    <td rowspan="@kvp.Value.Count()"> @kvp.Value[i].Product.Category.BinNo</td>
                    <td rowspan="@kvp.Value.Count()">@kvp.Value.Sum(item => item.QtyNeeded)</td>
                    <td rowspan="@kvp.Value.Count()" class="retrieved">@kvp.Value.Sum(item => item.QtyNeeded)</td>
                }
                <td> @kvp.Value[i].RequisitionId</td>
                <td>@kvp.Value[i].Requisition.Department.Name</td>
                <td>@kvp.Value[i].QtyNeeded</td>
                <td><input type="number" class="actualNumber" value="@kvp.Value[i].QtyNeeded" /></td>
                <td><input type="text" class="remarks" /></td>
            </tr>
                }

            </table>
        }
    }

    <textarea rows="3" id="comments" style="display:none"></textarea>

    <label>Adjustment Voucher needed?: </label>
    <input type="checkbox" id="needVoucher"/>

    <button type="button" id="update">Update</button>
    <button type="button" id="finalise">Finalise Retrieval</button>*@



<script src="~/js/RetrievalForm.js" asp-append-version="true"></script>